all:
  vars:
    ansible_user: deployer
    ansible_connection: ssh
    ansible_system: Linux
  children:
    local:
      hosts:
        localhost:
      vars:
        ansible_connection: local
        ansible_python_interpreter: "{{ansible_playbook_python}}"
    
    splunk_standalone:
      vars:
        splunk:
          hostname: "{{ inventory_hostname }}"
          role: "splunk_standalone"
      hosts: 
        splksh4.psl.local:
    splunk_search_head_captain:
      vars:
        search_head_cluster_host: "{{ groups['splunk_search_head_captain'][0] }}"
        splunk:
          hostname: "{{ inventory_hostname }}"
          role: 
            "{% if inventory_hostname == search_head_cluster_host %}
            {{ 'splunk_search_head_captain' }}
            {% else %}
            {{ 'splunk_search_head' }}
            {% endif %}"
          search_head_cluster_url: "{{ search_head_cluster_host }}"
      hosts: 
        splksh1.psl.local:
    splunk_search_head:
      vars:
        search_head_cluster_host: "{{ groups['splunk_search_head_captain'][0] }}"
        splunk:
          hostname: "{{ inventory_hostname }}"
          role: 
            "{% if inventory_hostname == search_head_cluster_host %}
            {{ 'splunk_search_head_captain' }}
            {% else %}
            {{ 'splunk_search_head' }}
            {% endif %}"
          search_head_cluster_url: "{{ search_head_cluster_host }}"
            
      hosts: 
        splksh1.psl.local:
        splksh2.psl.local:
        splksh3.psl.local:
    splunk_cluster_master:
      vars:
        splunk:
          hostname: "{{ inventory_hostname }}"
          role: "splunk_cluster_master"
      hosts: 
        splkcm1.psl.local
    splunk_indexer:
      vars:
        splunk:
          hostname: "{{ inventory_hostname }}"
          role: "splunk_indexer"
      hosts: 
        splkidx1.psl.local:
        splkidx2.psl.local:
        splkidx3.psl.local:
    splunk_deployment_server:
      vars:
        splunk:
          hostname: "{{ inventory_hostname }}"
          role: "splunk_license_master"
      hosts: 
        splkdp1.psl.local:
    splunk_license_master:
      vars:
        splunk:
          hostname: "{{ inventory_hostname }}"
          role: "splunk_license_master"
      hosts: 
        splkdp1.psl.local:
    splunk_deployer:
      vars:
        splunk:
          hostname: "{{ inventory_hostname }}"
          # Note: this server has two roles (LM and DP) - we need to set the role to 
          # splunk_license_master or it will get added as a local slave to itself.
          # This cases delays in deployment and general non-goodness :)
          role: "splunk_license_master"
      hosts: 
        splkdp1.psl.local: