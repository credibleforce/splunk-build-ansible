---
#######################################################################################################################
# EXAMPLE STANDALONE DEPLOYMENT
#######################################################################################################################
- hosts: local
  vars_files:
    - ../vars/default.yml 
  pre_tasks:
  tasks:
    - name: Download Splunk
      include_role:
        name: download_splunk

#######################################################################################################################
# INSTALL INDEXER AND SEARCH HEAD
#######################################################################################################################

- hosts: splunk_indexer:splunk_search_head
  vars_files:
    - ../vars/default.yml
  gather_facts: True
  pre_tasks:

    # PRE CONFIG - Add users
    - name: Custom splunk server pre-config (setup user)
      include_role:
        name: pre_config
  
    #########################################
    # VARIABLES DEFINING DEPLOYED ENVIRONMENT
    ##########################################
    
    # Include additional variables as required
    - name: Include Global S2S Variable
      include_vars: ../vars/splunk_s2s.yml

    - name: Include Global HEC Variable
      include_vars: ../vars/splunk_hec.yml

    - name: Include Global DFS Variable
      include_vars: ../vars/splunk_dfs.yml

    # setup distributed search for splunk_search_heads
    - name: Include Distributed Search Peer Variable
      include_vars: ../vars/splunk_distributed.yml
      when: inventory_hostname in groups['splunk_search_head']

  post_tasks:
    # Set ulimits by service (assumes systemd service deployment)
    - name: Post install config
      import_tasks: ../roles/post_config/tasks/main.yml
  tasks:
    # INDEXER - check for splunk_indexer role
    - name: Splunk splunk_indexer tasks
      include_role:
        name: splunk_indexer
      when: inventory_hostname in groups['splunk_indexer']

    # SEARCH HEAD - check for splunk_search_head role
    - name: Splunk splunk_search_head tasks
      include_role:
        name: splunk_search_head
      when: inventory_hostname in groups['splunk_search_head']