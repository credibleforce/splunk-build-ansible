---
#########################################
# EXAMPLE STANDALONE DEPLOYMENT
#########################################
- hosts: local
  vars_files:
    - ../vars/default-standalone.yml 
  tasks:
    # Force an ntp update as service check requires time sync to work (should not be required in production)
    - name: Sync ntp
      include_role: 
        name: ntp_sync
        
    - name: Download Splunk
      include_role:
        name: download_splunk

- hosts: splunk_standalone
  vars_files:
    - ../vars/default-standalone.yml
  gather_facts: True
  pre_tasks:
    # Force an ntp update as service check requires time sync to work (should not be required in production)
    - name: Sync ntp
      include_role: 
        name: ntp_sync

    # PRE CONFIG - Add users
    - name: Custom splunk server pre-config (setup user)
      include_role:
        name: pre_config
  
  post_tasks:
    # Set ulimits by service (assumes systemd service deployment)
    - name: Post install config
      import_tasks: ../roles/post_config/tasks/main.yml
  tasks:

    - name: Include deployment vars
      include_vars: ../vars/{{ item }}.yml
      with_items: "{{ deployment_type }}"

    - name: get facts
      include_tasks: ../splunk-ansible/roles/splunk_common/tasks/get_facts.yml

    - name: Splunk Deployment Server Variable
      debug:
        msg: 
          - "Deployment Type: [{{ deployment_type }}]"
          - "Splunk Cluster Master URL Check: [{{ True if 'cluster_master_url' in splunk and splunk.cluster_master_url else False }}]"
          - "Splunk Index Cluster Variable Defined: [{{splunk_indexer_cluster is defined}}]"
          - "Splunk Forward Servers Defined: [{{ splunk_forward_servers is defined }}]"

    - name: Pause
      pause:
        prompt: "Press any key to continue"

    # STANDALONE - check for splunk_standalone role
    - name: Splunk splunk_standalone tasks
      include_role:
        name: splunk_standalone
      when: inventory_hostname in groups['splunk_standalone']