all:
  children:
    local:
      hosts:
        localhost:
      vars:
        ansible_connection: local
        ansible_python_interpreter: "{{ansible_playbook_python}}"
    splunk:
      vars:
        ansible_connection: ssh
        ansible_system: Linux
        splunk:
          hostname: "{{ inventory_hostname }}"
      children:
        splunk_standalone:
          vars:
            splunk:
              role: "splunk_standalone"
          hosts: 
              splksh1.psl.local:
          # leave this here to stop triggering event forwarding :(=====
          children:
            splunk_search_head:
              hosts:
        splunk_search_head_captain:
          vars:
            is_captain: "{{ inventory_hostname == search_head_cluster_host|default(omit) }}"
            splunk:
              hostname: "{{ inventory_hostname }}"
              role: 
                "{{ 'splunk_search_head_captain' if is_captain else 'splunk_search_head' }}"
          hosts: 
            splksh1.psl.local:
              splunk:
                site: "{{ splunk_default_site|default(omit) }}"
        splunk_search_head:
          vars:
            is_captain: "{{ inventory_hostname == search_head_cluster_host|default(omit) }}"
            splunk:
              role: 
                "{{ 'splunk_search_head_captain' if is_captain else 'splunk_search_head' }}"
          hosts: 
            splksh1.psl.local:
              splunk:
                site: "{{ splunk_default_site|default(omit) }}"
            splksh2.psl.local:
              splunk:
                site: "{{ splunk_default_site|default(omit) }}"
            splksh3.psl.local:
              splunk:
                site: "{{ splunk_default_site|default(omit) }}"
        splunk_cluster_master:
          vars:
            splunk:
              role: "splunk_cluster_master"
          hosts: 
            splkcm1.psl.local:
              splunk:
                site: "{{ splunk_default_site|default(omit) }}"
        splunk_indexer:
          vars:
            splunk:
              role: "splunk_indexer"
          hosts: 
            splkidx1.psl.local:
              splunk:
                site: "{{ splunk_default_site|default(omit) }}"
            splkidx2.psl.local:
              splunk:
                site: "{{ splunk_default_site|default(omit) }}"
            splkidx3.psl.local:
              splunk:
                # example of multi site
                site: "{{ 'site2' if splunk.all_sites is defined else splunk_default_site|default(omit) }}"
            splkidx4.psl.local:
              splunk:
                # example of multi site
                site: "{{ 'site2' if splunk.all_sites is defined else splunk_default_site|default(omit) }}"
        splunk_deployment_server:
          vars:
            splunk:
              role: "splunk_license_master"
          hosts: 
            splkdp1.psl.local:
        splunk_license_master:
          vars:
            splunk:
              role: "splunk_license_master"
          hosts: 
            splkdp1.psl.local:
        splunk_deployer:
          vars:
            splunk:
              # Note: this server has two roles (LM and DP) - we need to set the role to 
              # splunk_license_master or it will get added as a local slave to itself.
              # This cases delays in deployment and general non-goodness :)
              role: "splunk_license_master"
          hosts: 
            splkdp1.psl.local:
              splunk:
                site: "{{ splunk_default_site|default(omit) }}"
        splunk_distributed_monitoring_console:
          vars:
            splunk:
              role: "splunk_distributed_monitoring_console"
          hosts:
            splkdp1.psl.local: